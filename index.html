<!DOCTYPE html>
<html>
<head>
</head>
<body style="margin: 0; background-color: #dedbb4; height: 100vh; width: 100vw">
	<div id="map" style="background-image: url('sea.png');background-repeat: no-repeat;width:930px;height:557px;position:absolute">
		<div id="coords" style="position: absolute;z-index: 20;background-color: #dedbb4;padding:2px 5px;border-radius: 3px; width: 100px"></div>
	</div>
	<script>
		var boats = [
			'W051425 S125108',
			'W035215 S130129',
			'W034209 S132318',
			'W040547 S135602',
			'W031215 S134933',
			'W024047 S131046',
			'W034259 S123059',
			'W040357 S121035',
			'W045031 S114851',
			'W043732 S105718',
			'W050356 S105600',
			'W051553 S095836',
			'W045851 S095233',
			'W045154 S101010',
			'W043828 S095104',
			'W043557 S093853',
			'W045039 S093910',
			'W050612 S093930',
			'W050258 S092528',
			'W052453 S093008',
			'W050305 S091059',
			'W043712 S090706',
			'W031112 S112810',
			'W040355 S111106',
			'W041840 S101345',
			'W042318 S100021',
			'W034613 S102719',
			'W031540 S104112',
			'W034616 S102608',
			'W042353 S100020',
			'W041913 S101323',
			'W041454 S093206',
			'W034907 S090310',
			'W033211 S093008',
			'W030455 S094213',
			'W002558 S103230',
			'W002140 S103705',
			'W000657 S111142',
			'W000647 S111712',
			'W001040 S112140',
			'E000316 S112120',
			'E004920 S103342',
			'E012553 S102042',
			'W002130 S060700', 
			'W004040 S060840', 
			'W010420 S060700', 
			'W010740 S061530', 
			'W004720 S061500', 
			'W003050 S062000', 
			'W000840 S062400', 
			'W005000 S062900', 
			'W011600 S062750', 
			'W012910 S063125', 
			'W015110 S064030', 
			'W014030 S065020', 
			'W012830 S064750', 
			'W011330 S064200', 
			'W005600 S063920', 
			'W002230 S064240', 
			'W002750 S065720', 
			'W005040 S065710', 
			'W011830 S070220', 
			'W013540 S070420', 
			'W014940 S071640', 
			'W013430 S071350', 
			'W011240 S071230', 
			'W003620 S070430', 
			'W001950 S070600', 
			'W000830 S070830', 
			'W003900 S071610', 
			'W005730 S072400', 
			'W014600 S073100', 
			'W011910 S073710', 
			'W004800 S073930', 
			'W001343 S072447', 
			'W000151 S073227', 
			'W001720 S075240', 
			'W003200 S074340', 
			'W004740 S075310', 
			'W011130 S075800', 
			'W013400 S075240', 
			'W062140 S122927',
			'W042716 S125815',
			'W053253 S141131',
			'W053850 S111128',
			'W053531 S113846',
			'W053409 S115842',
			'W051114 S121217',
			'W044706 S122128',
			'W043228 S112023',
		]
		var state = new Set()
		var origX = 46000
		var origY = 8400
		var step = 81.5
		function getCookie(name) {
  			let matches = document.cookie.match(new RegExp("(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"));
  			return matches ? decodeURIComponent(matches[1]) : undefined;
		}
		function setCookie(name, value, options = {}) {

  			options = {
    				path: '/',
    				...options
  			};

  			if (options.expires instanceof Date) {
    				options.expires = options.expires.toUTCString();
  			}

  			let updatedCookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);

  			for (let optionKey in options) {
    				updatedCookie += "; " + optionKey;
    				let optionValue = options[optionKey];
    				if (optionValue !== true) {
      					updatedCookie += "=" + optionValue;
    				}
  			}
			
  			document.cookie = updatedCookie;
		}
		function saveState(){
			let temp = []
			for(let s of state){
				temp.push(s)
			}
			setCookie('aaboats', temp.join(','))
		}
		function loadState(){
			let temp = getCookie('aaboats')
			if(temp) {
				state = new Set(temp.split(','))
				for(let s of state){
					document.getElementById(s).style.backgroundColor = 'green'
				}
			}
		}
		function mousemove(event){
			event.stopPropagation()
			event.preventDefault()
			let coordsEl = document.getElementById('coords')
			
			if(event.target.classList.contains("marker")){
				document.getElementById('coords').innerHTML = event.target.coords
			} else {
				coordsEl.style.left = `${event.offsetX + 15}px`
				coordsEl.style.top = `${event.offsetY + 15}px`
				let offsetX = event.offsetX * step
				let offsetY = event.offsetY * step
				let currentX = origX - offsetX
				let currentY = origY + offsetY
				let hoursX = Math.abs(parseInt(currentX / 3600))
				let minutesX = Math.abs(parseInt(parseInt(currentX % 3600) / 60))
				let secondsX = Math.abs(parseInt(currentX % 60))
				let hoursY = Math.abs(parseInt(currentY / 3600))
				let minutesY = Math.abs(parseInt(parseInt(currentY % 3600) / 60))
				let secondsY = Math.abs(parseInt(currentY % 60))
				coordsEl.innerHTML = `${currentX > 0 ? 'W' : 'E'} ${hoursX}째 ${minutesX}' ${secondsX}"<br>${currentY > 0 ? 'S' : 'N'} ${hoursY}째 ${minutesY}' ${secondsY}"`
			}
			
		}
		function mousedown (){
			event.stopPropagation()
			event.preventDefault()
			this.style.backgroundColor = 'green'
			state.add(this.id)
			saveState()
		}
		function contextmenu (){
			event.stopPropagation()
			event.preventDefault()
			this.style.backgroundColor = 'blue'
			state.remove(this.id)
			loadState()
		}
		for(let i = 0; i < boats.length; i++){
			let coords = boats[i].split(' ')
			let hoursX = parseInt(coords[0][1]+coords[0][2])
			let minutesX = parseInt(coords[0][3]+coords[0][4])
			let secondsX = parseInt(coords[0][5]+coords[0][6])
			let hoursY = parseInt(coords[1][1]+coords[1][2])
			let minutesY = parseInt(coords[1][3]+coords[1][4])
			let secondsY = parseInt(coords[1][1]+coords[1][2])
			let currentX = coords[0][0] === 'W' ? origX - (hoursX*3600+minutesX*60+secondsX) : origX + (hoursX*3600+minutesX*60+secondsX)
			let currentY = (hoursY*3600+minutesY*60+secondsY) - origY
			let offsetX = currentX / step
			let offsetY = currentY / step
			let elem = document.createElement('div')
			elem.style.position = 'absolute'
			elem.style.left = `${offsetX-4}px`
			elem.style.top = `${offsetY-4}px`
			elem.style.width = '8px'
			elem.style.height = '8px'
			elem.style.borderRadius = '50%'
			elem.style.backgroundColor = 'blue'
			elem.style.zIndex = '10'
			elem.id = i
			elem.classList.add("marker")
			elem.addEventListener('mousedown', mousedown)
			elem.addEventListener('contextmenu', contextmenu)
			elem.coords = `${coords[0][0]} ${hoursX}째 ${minutesX}' ${secondsX}"<br>${coords[1][0]} ${hoursY}째 ${minutesY}' ${secondsY}"`
			document.getElementById('map').appendChild(elem)

		}
		document.getElementById('map').addEventListener('mousemove', mousemove)
		
		loadState()
		let map = document.getElementById('map')
		map.style.left = `${(document.body.clientWidth - map.clientWidth)/2}px`
		map.style.top = `${(document.body.clientHeight - map.clientHeight)/2}px`
		document.body.onresize = function(){
			let map = document.getElementById('map')
			map.style.left = `${(document.body.clientWidth - map.clientWidth)/2}px`
			map.style.top = `${(document.body.clientHeight - map.clientHeight)/2}px`
		}
	</script>
</body>
</html>
